From 94341b54615d8efb592643853d397b16b33735df Mon Sep 17 00:00:00 2001
From: Alistair Leslie-Hughes <leslie_alistair@hotmail.com>
Date: Tue, 9 Sep 2025 09:10:34 +1000
Subject: [PATCH 2/8] tiptsf: Add dll

---
 configure.ac              |  1 +
 dlls/tiptsf/Makefile.in   |  5 +++++
 dlls/tiptsf/tiptsf.idl    | 21 +++++++++++++++++++++
 dlls/tiptsf/tiptsf.spec   | 11 +++++++++++
 dlls/tiptsf/tiptsf_main.c | 33 +++++++++++++++++++++++++++++++++
 include/peninputpanel.idl |  3 +++
 loader/wine.inf.in        |  2 ++
 7 files changed, 76 insertions(+)
 create mode 100644 dlls/tiptsf/Makefile.in
 create mode 100644 dlls/tiptsf/tiptsf.idl
 create mode 100644 dlls/tiptsf/tiptsf.spec
 create mode 100644 dlls/tiptsf/tiptsf_main.c

diff --git a/configure.ac b/configure.ac
index 819b58f4206..95d6624e422 100644
--- a/configure.ac
+++ b/configure.ac
@@ -3194,6 +3194,7 @@ WINE_CONFIG_MAKEFILE(dlls/tdh)
 WINE_CONFIG_MAKEFILE(dlls/tdi.sys)
 WINE_CONFIG_MAKEFILE(dlls/threadpoolwinrt)
 WINE_CONFIG_MAKEFILE(dlls/threadpoolwinrt/tests)
+WINE_CONFIG_MAKEFILE(dlls/tiptsf)
 WINE_CONFIG_MAKEFILE(dlls/toolhelp.dll16)
 WINE_CONFIG_MAKEFILE(dlls/traffic)
 WINE_CONFIG_MAKEFILE(dlls/twain.dll16)
diff --git a/dlls/tiptsf/Makefile.in b/dlls/tiptsf/Makefile.in
new file mode 100644
index 00000000000..3db54dfe0d5
--- /dev/null
+++ b/dlls/tiptsf/Makefile.in
@@ -0,0 +1,5 @@
+MODULE    = tiptsf.dll
+
+SOURCES = \
+	tiptsf_main.c \
+	tiptsf.idl
diff --git a/dlls/tiptsf/tiptsf.idl b/dlls/tiptsf/tiptsf.idl
new file mode 100644
index 00000000000..95060d45df0
--- /dev/null
+++ b/dlls/tiptsf/tiptsf.idl
@@ -0,0 +1,21 @@
+/*
+ * Copyright 2025 Alistair Leslie-Hughes
+ *
+ * This library is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Lesser General Public
+ * License as published by the Free Software Foundation; either
+ * version 2.1 of the License, or (at your option) any later version.
+ *
+ * This library is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with this library; if not, write to the Free Software
+ * Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301, USA
+ */
+
+#pragma makedep register
+
+#include "peninputpanel.idl"
diff --git a/dlls/tiptsf/tiptsf.spec b/dlls/tiptsf/tiptsf.spec
new file mode 100644
index 00000000000..40feedd7dd3
--- /dev/null
+++ b/dlls/tiptsf/tiptsf.spec
@@ -0,0 +1,11 @@
+@ stub AdviseHook
+@ stub EndCaretTracking
+@ stub ProcessCaretEvents
+@ stub ProcessCiceroCaretEvent
+@ stub RestrictedModeMsgWndProc
+@ stub StartCaretTracking
+@ stub UnadviseHook
+@ stdcall -private DllCanUnloadNow()
+@ stdcall -private DllGetClassObject(ptr ptr ptr)
+@ stdcall -private DllRegisterServer()
+@ stdcall -private DllUnregisterServer()
diff --git a/dlls/tiptsf/tiptsf_main.c b/dlls/tiptsf/tiptsf_main.c
new file mode 100644
index 00000000000..137acf9630c
--- /dev/null
+++ b/dlls/tiptsf/tiptsf_main.c
@@ -0,0 +1,33 @@
+/*
+ * Copyright 2025 Alistair Leslie-Hughes
+ *
+ * This library is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Lesser General Public
+ * License as published by the Free Software Foundation; either
+ * version 2.1 of the License, or (at your option) any later version.
+ *
+ * This library is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with this library; if not, write to the Free Software
+ * Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301, USA
+ */
+#include <stdarg.h>
+
+#include "windef.h"
+#include "winbase.h"
+#include "peninputpanel.h"
+
+#include "wine/debug.h"
+
+WINE_DEFAULT_DEBUG_CHANNEL(tiptsf);
+
+HRESULT WINAPI DllGetClassObject( REFCLSID rclsid, REFIID riid, void **ppv )
+{
+    FIXME("%s %s %p\n", debugstr_guid(rclsid), debugstr_guid(riid), ppv);
+
+    return CLASS_E_CLASSNOTAVAILABLE;
+}
\ No newline at end of file
diff --git a/include/peninputpanel.idl b/include/peninputpanel.idl
index d7ba0cc36e1..1007a866003 100644
--- a/include/peninputpanel.idl
+++ b/include/peninputpanel.idl
@@ -194,6 +194,9 @@ interface ITextInputPanel : IUnknown
 }
 
 [
+    progid("TextInputPanel.TextInputPanel.1"),
+    vi_progid("TextInputPanel.TextInputPanel"),
+    threading(apartment),
     uuid(f9b189d7-228b-4f2b-8650-b97f59e02c8c)
 ]
 coclass TextInputPanel
diff --git a/loader/wine.inf.in b/loader/wine.inf.in
index 68415d7977e..1e505bb9117 100644
--- a/loader/wine.inf.in
+++ b/loader/wine.inf.in
@@ -1025,6 +1025,7 @@ HKLM,SOFTWARE\Microsoft\VisualStudio\14.0\VC\Runtimes\x86,"Version",2,"14.42.344
 16422,Internet Explorer,iexplore.exe
 16422,Windows Media Player,wmplayer.exe
 16422,Windows NT\Accessories,wordpad.exe
+16427,Microsoft Shared\Ink,tiptsf.dll
 16427,System\OLE DB,oledb32.dll
 16427,System\OLE DB,msdaps.dll
 16427,System\OLE DB,msdasql.dll
@@ -1092,6 +1093,7 @@ HKLM,SOFTWARE\Microsoft\VisualStudio\14.0\VC\Runtimes\x86,"Version",2,"14.42.344
 16422,Windows Media Player,wmplayer.exe
 16422,Windows NT\Accessories,wordpad.exe
 16427,Microsoft Shared\TextConv,
+16427,Microsoft Shared\Ink,tiptsf.dll
 16427,System\OLE DB,oledb32.dll
 16427,System\OLE DB,msdaps.dll
 16427,System\OLE DB,msdasql.dll
-- 
2.51.0

